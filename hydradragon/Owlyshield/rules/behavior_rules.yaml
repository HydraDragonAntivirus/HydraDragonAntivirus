- name: "HEUR:Win64.PSW.Stealer.BehavesLike.Exela.gen"
  description: >
    Advanced detection for browser stealers using IoC-style indicators.
    Includes signature-based allowlisting and separated archive monitoring.
  conditions_percentage: 0.5
  require_internet: true
  time_window_ms: 30000
  multi_access_threshold: 2
  max_staging_lifetime_ms: 60000
  entropy_threshold: 7.0
  require_browser_closed_recently: true

  browser_paths: *browser_paths
  sensitive_files:
    - "Cookies"
    - "Login Data"
    - "Web Data"
    - "Local State"
  staging_paths:
    - "AppData\\Local\\Temp"

  # Archive Signals (Separated)
  archive_apis:
    - "CreateZip"
    - "CreateRar"
  archive_tools:
    - "7z"
    - "tar"
  archive_actions:
    - ".zip"
    - ".rar"

  # Crypto Indicators
  crypto_apis:
    - "CryptUnprotectData"
    - "BCryptDecrypt"
    - "NCryptDecrypt"
    - "DPAPI"

  # Process Ancestry Indicators
  suspicious_parents:
    - "powershell.exe"
    - "cmd.exe"
    - "wscript.exe"
    - "cscript.exe"
    - "mshta.exe"
    - "python.exe"
    - "node.exe"

  # Advanced Allowlist (Signature-based)
  allowlisted_apps:
    - pattern: "chrome.exe"
      must_be_signed: true
      signers: ["Google.*"]
    - pattern: "msedge.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "brave.exe"
      must_be_signed: true
      signers: ["Brave Software.*"]
    - pattern: "opera.exe"
      must_be_signed: true
      signers: ["Opera.*"]
    - pattern: "discord.exe"
      must_be_signed: true
      signers: ["Discord.*"]
    - pattern: "code.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "visualstudio.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "devenv.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "codium.exe"
      must_be_signed: false
    - pattern: "vscodium.exe"
      must_be_signed: false
