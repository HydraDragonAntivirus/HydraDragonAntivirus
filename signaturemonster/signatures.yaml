# Signature Monster - Comprehensive Rules Database
# Version: 0.1.0

version: "0.1.0"
description: "Comprehensive signature database"
author: "SignatureMonster Team"

rules:
  # =============================================================================
  # ANTI-DEBUG DETECTIONS
  # Based on: examples/AntiDebug/*
  # =============================================================================

  - id: "antidebug_blacklisted_windows"
    name: "Blacklisted Window Titles Detected"
    description: "Detects analysis and debugging tools by their window titles"
    match_type: Any
    actions:
      - type: Exit
        code: 1
    conditions:
      # Debuggers
      - type: Process
        name: "x64dbg.exe"
        regex: false
      - type: Process
        name: "x32dbg.exe"
        regex: false
      - type: Process
        name: "ollydbg.exe"
        regex: false
      - type: Process
        name: "ida64.exe"
        regex: false
      - type: Process
        name: "ida.exe"
        regex: false
      - type: Process
        name: "windbg.exe"
        regex: false
      # Reverse Engineering
      - type: Process
        name: "dnspy.exe"
        regex: false
      - type: Process
        name: "ilspy.exe"
        regex: false
      - type: Process
        name: "ghidra.exe"
        regex: false
      - type: Process
        name: "pestudio.exe"
        regex: false
      # Network Analysis
      - type: Process
        name: "wireshark.exe"
        regex: false
      - type: Process
        name: "fiddler.exe"
        regex: false
      - type: Process
        name: "httpdebuggerui.exe"
        regex: false
      - type: Process
        name: "HTTP Toolkit.exe"
        regex: false
      # Process Monitoring
      - type: Process
        name: "procmon.exe"
        regex: false
      - type: Process
        name: "procmon64.exe"
        regex: false
      - type: Process
        name: "processhacker.exe"
        regex: false
      # Memory Dumpers
      - type: Process
        name: "megadumper.exe"
        regex: false
      - type: Process
        name: "extremedumper.exe"
        regex: false
      - type: Process
        name: "ksdumper.exe"
        regex: false
      - type: Process
        name: "ksdumperclient.exe"
        regex: false

  - id: "antidebug_banned_processes"
    name: "Banned Analysis Processes Running"
    description: "Detects processes commonly used for malware analysis"
    match_type: Any
    conditions:
      - type: Process
        name: "df5serv.exe"
        regex: false
      - type: Process
        name: "joeboxcontrol.exe"
        regex: false
      - type: Process
        name: "joeboxserver.exe"
        regex: false
      - type: Process
        name: "petools.exe"
        regex: false
      - type: Process
        name: "hxd.exe"
        regex: false
      - type: Process
        name: "protection_id.exe"
        regex: false
      - type: Process
        name: "scyllahide.exe"
        regex: false
      - type: Process
        name: "de4dot.exe"
        regex: false

  # =============================================================================
  # ANTI-VIRTUALIZATION DETECTIONS
  # Based on: examples/AntiVirtualization/*
  # =============================================================================

  - id: "vm_vmware"
    name: "VMware Virtual Machine"
    description: "Detects VMware virtualization environment"
    match_type: Any
    conditions:
      - type: DiskModel
        pattern: "vmware"
        regex: false
      - type: Process
        name: "vmtoolsd.exe"
        regex: false
      - type: Process
        name: "vmacthlp.exe"
        regex: false
      - type: Process
        name: "vgauthservice.exe"
        regex: false
      - type: Registry
        path: "HKLM\\SOFTWARE\\VMware, Inc.\\VMware Tools"
      - type: Service
        name: "VMTools"
        must_be_running: false

  - id: "vm_virtualbox"
    name: "VirtualBox Virtual Machine"
    description: "Detects VirtualBox virtualization environment"
    match_type: Any
    conditions:
      - type: DiskModel
        pattern: "vbox"
        regex: false
      - type: Process
        name: "VBoxService.exe"
        regex: false
      - type: Process
        name: "VBoxTray.exe"
        regex: false
      - type: Registry
        path: "HKLM\\SOFTWARE\\Oracle\\VirtualBox Guest Additions"
      - type: Service
        name: "VBoxService"
        must_be_running: false

  - id: "vm_hyperv"
    name: "Hyper-V Virtual Machine"
    description: "Detects Microsoft Hyper-V virtualization environment"
    match_type: Any
    conditions:
      - type: DiskModel
        pattern: "virtual hd"
        regex: false
      - type: DiskModel
        pattern: "microsoft virtual"
        regex: false
      - type: Registry
        path: "HKLM\\SOFTWARE\\Microsoft\\Virtual Machine\\Guest\\Parameters"
      - type: Service
        name: "vmicheartbeat"
        must_be_running: false

  - id: "vm_qemu"
    name: "QEMU Virtual Machine"
    description: "Detects QEMU virtualization environment"
    match_type: Any
    conditions:
      - type: DiskModel
        pattern: "qemu"
        regex: false
      - type: Process
        name: "qemu-ga.exe"
        regex: false

  - id: "vm_kvm"
    name: "KVM Virtual Machine"
    description: "Detects KVM virtualization environment"
    match_type: Any
    conditions:
      - type: DiskModel
        pattern: "virtio"
        regex: false
      - type: Registry
        path: "HKLM\\HARDWARE\\DESCRIPTION\\System\\BIOS"
        value_name: "SystemManufacturer"
        expected_data: "QEMU"

  - id: "vm_parallels"
    name: "Parallels Virtual Machine"
    description: "Detects Parallels Desktop virtualization environment"
    match_type: Any
    conditions:
      - type: Process
        name: "prl_cc.exe"
        regex: false
      - type: Process
        name: "prl_tools.exe"
        regex: false
      - type: DiskModel
        pattern: "parallels"
        regex: false

  - id: "vm_xen"
    name: "Xen Virtual Machine"
    description: "Detects Xen virtualization environment"
    match_type: Any
    conditions:
      - type: Process
        name: "xenservice.exe"
        regex: false
      - type: DiskModel
        pattern: "xen"
        regex: false

  # =============================================================================
  # SANDBOX DETECTIONS
  # Based on: examples/AntiVirtualization/SandboxieDetection, TriageDetection, etc.
  # =============================================================================

  - id: "sandbox_sandboxie"
    name: "Sandboxie Environment"
    description: "Detects Sandboxie sandbox environment"
    match_type: Any
    conditions:
      - type: File
        path: "C:\\Program Files\\Sandboxie\\"
        must_exist: true
      - type: File
        path: "C:\\Program Files (x86)\\Sandboxie\\"
        must_exist: true
      - type: Service
        name: "SbieSvc"
        must_be_running: false
      - type: Registry
        path: "HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\Sandboxie"
      - type: Registry
        path: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"
        value_name: "SandboxiePlus_AutoRun"

  - id: "sandbox_anyrun"
    name: "ANY.RUN Sandbox"
    description: "Detects ANY.RUN online sandbox environment"
    match_type: Any
    conditions:
      - type: Hwid
        field: ComputerName
        pattern: "ANYRUN"
        regex: false
      - type: User
        name: "anyrun"
        regex: false

  - id: "sandbox_triage"
    name: "Triage Sandbox"
    description: "Detects Triage/Hatching sandbox environment"
    match_type: Any
    conditions:
      - type: DiskModel
        pattern: "DADY HARDDISK"
        regex: false
      - type: DiskModel
        pattern: "QEMU HARDDISK"
        regex: false

  - id: "sandbox_joesandbox"
    name: "Joe Sandbox"
    description: "Detects Joe Sandbox environment"
    match_type: Any
    conditions:
      - type: Process
        name: "joeboxcontrol.exe"
        regex: false
      - type: Process
        name: "joeboxserver.exe"
        regex: false

  - id: "sandbox_cybercapture"
    name: "Avast CyberCapture"
    description: "Detects Avast CyberCapture sandbox environment"
    match_type: Any
    conditions:
      - type: User
        name: "WDAGUtilityAccount"
        regex: false

  - id: "sandbox_deepfreeze"
    name: "Deep Freeze Environment"
    description: "Detects Deep Freeze system protection"
    match_type: Any
    conditions:
      - type: Process
        name: "DFServ.exe"
        regex: false
      - type: Service
        name: "DFServ"
        must_be_running: false

  - id: "sandbox_comodo"
    name: "Comodo Container/Sandbox"
    description: "Detects Comodo containment environment"
    match_type: Any
    conditions:
      - type: Registry
        path: "HKLM\\SYSTEM\\CurrentControlSet\\Services\\cmdGuard"
      - type: Service
        name: "cmdGuard"
        must_be_running: false

  - id: "sandbox_shadowdefender"
    name: "Shadow Defender"
    description: "Detects Shadow Defender virtualization"
    match_type: Any
    conditions:
      - type: Registry
        path: "HKLM\\SOFTWARE\\ShadowDefender"
      - type: Service
        name: "ShadowDefenderService"
        must_be_running: false

  # =============================================================================
  # BLACKLISTED USERNAMES/COMPUTER NAMES
  # Based on: examples/AntiVirtualization/UsernameCheck and CheckBlacklistedWindowsNames
  # =============================================================================

  - id: "blacklist_usernames"
    name: "Blacklisted Username"
    description: "Detects usernames commonly used in analysis environments"
    match_type: Any
    conditions:
      - type: User
        name: "Johnson"
        regex: false
      - type: User
        name: "Miller"
        regex: false
      - type: User
        name: "malware"
        regex: false
      - type: User
        name: "maltest"
        regex: false
      - type: User
        name: "CurrentUser"
        regex: false
      - type: User
        name: "Sandbox"
        regex: false
      - type: User
        name: "virus"
        regex: false
      - type: User
        name: "John Doe"
        regex: false
      - type: User
        name: "test user"
        regex: false
      - type: User
        name: "sand box"
        regex: false
      - type: User
        name: "WDAGUtilityAccount"
        regex: false
      - type: User
        name: "Bruno"
        regex: false
      - type: User
        name: "george"
        regex: false
      - type: User
        name: "Harry Johnson"
        regex: false
      - type: User
        name: "analyst"
        regex: false
      - type: User
        name: "admin"
        regex: false

  - id: "blacklist_computernames"
    name: "Blacklisted Computer Name"
    description: "Detects computer names commonly used in analysis environments"
    match_type: Any
    conditions:
      - type: Hwid
        field: ComputerName
        pattern: "SANDBOX"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "ANALYSIS"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "MALWARE"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "VIRUS"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "DESKTOP-NAKFFMT"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "JOHN-PC"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "LISA-PC"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "JULIA-PC"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "WILEYPC"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "SERVER1"
        regex: false
      - type: Hwid
        field: ComputerName
        pattern: "WIN-5E07COS9ALR"
        regex: false

  # =============================================================================
  # BLACKLISTED UUIDs
  # Based on: examples/AntiDebug/CheckBlacklistedWindowsNames
  # =============================================================================

  - id: "blacklist_uuids"
    name: "Blacklisted System UUID"
    description: "Detects known analysis/sandbox system UUIDs"
    match_type: Any
    conditions:
      - type: Hwid
        field: SystemUuid
        pattern: "7AB5C494-39F5-4941-9163-47F54D6D5016"
        regex: false
      - type: Hwid
        field: SystemUuid
        pattern: "00000000-0000-0000-0000-000000000000"
        regex: false
      - type: Hwid
        field: SystemUuid
        pattern: "11111111-2222-3333-4444-555555555555"
        regex: false
      - type: Hwid
        field: SystemUuid
        pattern: "032E02B4-0499-05C3-0806-3C0700080009"
        regex: false
      - type: Hwid
        field: SystemUuid
        pattern: "49434D53-0200-9065-2500-65902500E439"
        regex: false
      - type: Hwid
        field: SystemUuid
        pattern: "B1112042-52E8-E25B-3655-6A4F54155DBF"
        regex: false
      - type: Hwid
        field: SystemUuid
        pattern: "D9142042-8F51-5EFF-D5F8-EE9AE3D1602A"
        regex: false

