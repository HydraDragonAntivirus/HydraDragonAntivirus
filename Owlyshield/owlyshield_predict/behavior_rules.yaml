# HydraDragon Ultimate EDR Behavioral Rules V4.0
# "Vibe Coding" Professional Standards: DLL, API & Cyber Kill-Chain Correlation

- name: "Attack Pipeline: Windows Credential Harvester"
  description: "Detects multi-stage activity targeting sensitive user data and credentials using specialized APIs."
  severity: 10
  mitre_mappings:
    - id: "T1539"
      name: "Steal Web Session Cookie"
      tactic: "CredentialAccess"
  # Stages of the attack
  attack_line: ["Google\\Chrome\\User Data", "Microsoft\\Edge\\User Data", "Mozilla\\Firefox\\Profiles"]
  attack_target: ["Cookies", "Login Data", "Local State", "Web Data"]
  attack_staging: ["AppData\\Local\\Temp"]
  pipeline_threshold: 2
  
  # Deep API & DLL Inspection
  suspicious_dll_patterns: ["crypt32", "bcrypt", "ncrypt", "winhttp"]
  suspicious_apis:
    - function_name: "cryptunprotectdata"
      module_name: "crypt32.dll"
    - function_name: "bcryptdecrypt"
      module_name: "bcrypt.dll"
    - function_name: "winhttpconnect"
      module_name: "winhttp.dll"
  
  suspicious_parents: ["powershell.exe", "cmd.exe", "wscript.exe"]
  terminate_process: true
  quarantine: true

- name: "Ransomware: Surgical Encryption Discovery"
  description: "Detects mass file access combined with high-entropy write primitives and crypto module loading."
  severity: 10
  mitre_mappings:
    - id: "T1486"
      name: "Data Encrypted for Impact"
      tactic: "Impact"
  entropy_threshold: 7.2
  required_dlls:
    - name: "advapi32.dll"
      critical: true
    - name: "bcrypt.dll"
      critical: true
  archive_actions: [".crypt", ".locked", ".enc", ".zip"]
  conditions_total: 2
  terminate_process: true
  quarantine: true

- name: "Trojan: Defense Evasion via System Tampering"
  description: "Detects service manipulation and Log clearing via command-line and registry."
  severity: 9
  mitre_mappings:
    - id: "T1562.001"
      name: "Disable or Modify Tools"
  service_stop_patterns: ["WinDefend", "Sense", "MpsSvc"]
  commandline_patterns:
    - "sc stop WinDefend"
    - "wevtutil cl System"
    - "vssadmin delete shadows"
  registry_indicators:
    - path: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System"
      value_name: "DisableTaskMgr"
      expected_data: "1"
  registry_locking: true
  terminate_process: true

- name: "Malware Family: Tasia Correlation"
  description: "High-confidence detection for Tasia family using specific system hijacks."
  severity: 10
  process_search: ["utilman.exe"]
  commandline_patterns: ["Debugger"]
  registry_indicators:
    - path: "HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe"
      value_name: "Debugger"
  conditions_total: 1
  terminate_process: true
  quarantine: true
