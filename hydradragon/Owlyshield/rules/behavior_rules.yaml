- name: "HEUR:Win64.PSW.Stealer.BehavesLike.Exela.gen"
  debug: true
  
  browsed_paths:
    - "%USERPROFILE%\\Google\\Chrome\\User Data"
    - "%USERPROFILE%\\AppData\\Local\\Google\\Chrome\\User Data"
    - "Opera Software\\Opera Stable"
    - "Opera Software\\Opera GX Stable"
    - "BraveSoftware\\Brave-Browser\\User Data"
    - "Microsoft\\Edge\\User Data"
    - "%APPDATA%\\Discord\\Local Storage"
    - "%APPDATA%\\Discord\\leveldb"
  
  accessed_paths:
    - "Cookies"
    - "Login Data"
    - "Web Data"
    - "Local State"
  
  staging_paths:
    - "%TEMP%"
    - "%APPDATA%\\Local\\Temp"
  
  multi_access_threshold: 2
  require_internet: true
  conditions_percentage: 1.0
  
  monitored_apis:
    - "CryptUnprotectData"
    - "BCryptDecrypt"
    - "NCryptDecrypt"
    - "DPAPI"
  
  archive_apis:
    - "CreateZip"
    - "CreateRar"
  
  archive_tools:
    - "7z.exe"
    - "tar.exe"
    - "winrar.exe"

  suspicious_parents:
    - "powershell.exe"
    - "cmd.exe"
    - "wscript.exe"
    - "cscript.exe"
    - "mshta.exe"
    - "python.exe"
    - "node.exe"
  
  entropy_threshold: 7.0
  
  file_actions: []
  
  file_extensions:
    - ".zip"
    - ".rar"

  terminated_processes:
    - "msedge.exe"
    - "chrome.exe"
    - "brave.exe"
    - "opera.exe"

  allowlisted_apps:
    - pattern: "chrome.exe"
      must_be_signed: true
      signers: ["Google.*"]
    - pattern: "msedge.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "brave.exe"
      must_be_signed: true
      signers: ["Brave Software.*"]
    - pattern: "opera.exe"
      must_be_signed: true
      signers: ["Opera.*"]
    - pattern: "discord.exe"
      must_be_signed: true
      signers: ["Discord.*"]
    - pattern: "code.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "visualstudio.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "devenv.exe"
      must_be_signed: true
      signers: ["Microsoft.*"]
    - pattern: "codium.exe"
      must_be_signed: false
    - pattern: "vscodium.exe"
      must_be_signed: false

  stages:
    - name: "Generic Startup Persistence Check"
      conditions:
        - type: "Registry"
          op: "write"
          key_pattern: "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\*"
          # Removed value_name/expected_data to allow detecting ANY startup addition "via registry"

    - name: "Sensitive Data Theft"
      conditions:
        - type: "DataExfiltrationPattern"
          detect_temp_staging: true
          source_patterns: ["*Credentials*"]

    - name: "Resource Access Fingerprint"
      conditions:
        - type: "File"
          path_pattern: "*\\Electrum\\wallets*"
          op: "read"

    - name: "GID Validation"
      conditions:
        - type: "Process"
          op: "check_gid"
          pattern: "*"

  response:
    terminate_process: true
    quarantine: true
    kill_and_remove: false
    auto_revert: true
